# 软件研发部安全方案

## 引言

2016 年，公安部会同民航局、国家电网组织开展了 “护网 2016”网络安全攻防演习活动。同年，《网络安全法》颁布，出台网络安全演练相关规定：关键信息基础设施的运营者应“制定网络安全事件应急预案，并定期进行演练”。自此“护网行动”进入人们视野，成为网络安全建设重要的一环。

### 网络安全演练

网络安全演练是指在网络安全事件应急预案的指导下，通过模拟网络安全事件，对网络安全事件应急预案的有效性、网络安全事件应急处置能力、网络安全事件应急处置流程等进行检验和评估的活动。

## 安全方案

防御方在演练中通常是较为被动的一方，需要在演练中对攻击方的攻击进行防御，防御方的防御能力是演练的重要指标之一。因此，制定切实可行的安全方案是演练的重要前提。

### 安全方案的构成

- 数据安全

- 应用安全

- 系统安全

   - 安全加固

   - 安全监控

- 安全规范

   - 安全防护

   - 应急处置

- 安全培训

### 安全方案的实施

#### 1. 数据安全

##### 1.1 数据交互

非必要不进行与客户的远程数据交互、数据回传等。确需传输的系统相关数据交互应以安全的方式进行，使用系统内建的方式、或安全加密工具进行传输。对数据访问增加访问控制，确保非合法人员无法查询响应数据。

##### 1.2 敏感数据

系统中确需保存的敏感数据应注意存储方式的安全性。无需保存的信息如账号密码等应使用如散列的方式替代。

##### 1.3 数据访问

客户敏感数据应当只能在授权的情形下被访问，应采取必要的安全防护措施，如访问控制、敏感信息权限控制、数据加密等方式提升数据安全性。

#### 2. 应用安全

##### 2.1 代码编写

软件仓库的活动应做到分权限管理，例如代码仓库管理、代码提交、保护分支、合并请求等均需要有分别对应的权限控制。

设立必要的代码安全扫描（测试）环节，针对可能风险较高的代码给予及时修正或拒绝合并等处理。

安全可靠地管理开发相关文档，确保文档不被破坏，不被非法用户查阅等。

##### 2.2 安全设计

对应用程序逻辑设计进行安全相关的审阅，例如未做访问控制的接口、耗进CPU的死循环、使进程崩溃的未捕获异常等。防止因代码设计造成的应用系统安全缺陷。

##### 2.3 访问控制设计

包括但不限于多因子认证、强密码规则、二次身份认证等。此外，应用应当设计合适的访问权限控制，以阻止针对非拥有资源的未授权访问。

##### 2.4 代码平台

针对代码平台应采取认证措施，且保证平台自身环境的安全性，例如托管环境应该是可信环境，非托管环境要有合适的访问授权等。

#### 3. 系统安全

##### 3.1. 安全加固

###### 3.1.1. 资产梳理

资产梳理是防御方案的第一步，需要对防御方的资产进行梳理，包括资产的类型、资产的数量、资产的重要性等。

- 类型：资产的类型包括服务器、数据库、网络设备、存储设备、应用系统等。

- 数量：资产的数量是防御方案的重要指标之一，需要对资产的数量进行统计。

- 重要性：资产的重要性是防御方案的重要指标之一，需要对资产的重要性进行评估。

  | 类型     | 数量 | 重要性 | 说明 |
  | -------- | ---- | ------ | ---- |
  | 服务器   | 100  | 重要   |      |
  | 数据库   | 10   | 重要   |      |
  | 网络设备 | 10   | 重要   |      |
  | 存储设备 | 10   | 重要   |      |
  | 应用系统 | 10   | 重要   |      |

###### 3.1.2. 系统加固

系统加固是防御方案的第二步，需要对防御方的系统进行加固，包括系统的安全配置、系统的安全补丁、系统的安全软件等。

1. 安全配置：系统的安全配置包括系统的账号配置、系统的访问控制、系统的日志配置等。

2. 安全补丁：系统的安全补丁包括系统的操作系统补丁、系统的应用软件补丁等。

3. 安全软件：系统的安全软件包括系统的入侵检测系统、系统的入侵防御系统等。

###### 3.1.3. 网络加固

网络安全通常需要对防御方的网络安全策略进行配置，包括网络的访问控制、网络的入侵检测、网络的入侵防御等。

1. 访问控制：网络的访问控制包括网络的访问控制策略、网络的访问控制设备等。
   针对应用服务器的访问控制策略，可以采用对网关服务器进行攻击行为检测，对于检测到的攻击行为，可以采用对应的防御措施进行防御。

   - 对于检测到的暴力破解攻击行为，可以采用拦阻 IP 地址的方式进行防御。
   - 对于检测到的 SQL 注入攻击行为，可以采用拦截 SQL 语句的方式进行防御。
   - 对于爬虫、扫描器等攻击行为，可以采用拦截请求的方式进行防御。
   - 对于检测到的恶意文件上传攻击行为，可以采用拦截文件的方式进行防御。

2. 入侵检测：对云主机，可以使用云主机的安全组功能进行入侵检测，对于物理主机，可以使用入侵检测系统进行入侵检测。
3. 入侵防御：通过识别、阻断、报警等方式进行入侵防御。

##### 3.2. 安全监控

###### 3.2.1. 安全监控

监控包括安全监控和业务监控，安全监控包括安全事件监控、安全设备监控、安全系统监控等。
安全事件监控：安全事件监控包括安全事件的识别、安全事件的分析、安全事件的处理等。
安全设备监控：安全设备监控包括安全设备的状态监控、安全设备的性能监控等。

###### 3.2.2. 安全审计

1. 安全审计的计划
   安全审计的计划包括安全审计的目标、安全审计的范围、安全审计的时间等。
2. 安全审计的执行

###### 3.2.3. 蜜罐

1. 蜜罐的概念
   蜜罐是一种安全设备，它的目的是为了诱骗攻击者，让攻击者攻击蜜罐，而不是攻击真正的系统。
2. 蜜罐的意义
   蜜罐的意义在于，它可以让攻击者攻击蜜罐，而不是真正的系统，从而保护真正的系统不受攻击者的攻击。在蜜罐中，攻击者可以进行攻击，但是攻击者无法获取到真正的系统中的数据，从而保护了真正的系统的数据不受攻击者的攻击。同时，蜜罐还可以记录攻击者的攻击行为，从而可以分析攻击者的攻击行为，从而可以对真正的系统进行防御。

3. 蜜罐的部署

   - 当前市面上已有较多的蜜罐可以做到即插即用，比如：Kippo、Cowrie、Honeyd 等。
   - 蜜罐的部署可以分为两种方式：一种是在物理机上部署蜜罐，一种是在虚拟机上部署蜜罐。容器化的蜜罐可以在物理机上部署，也可以在虚拟机上部署。物理机上部署蜜罐的优点是可以获得更好的性能，缺点是需要占用更多的物理资源。虚拟机上部署蜜罐的优点是可以节省物理资源，缺点是性能可能会受到影响。
   - 蜜罐的部署可以分为两种方式：一种是在公网上部署蜜罐，一种是在内网上部署蜜罐。公网上部署蜜罐的优点是可以获得更多的攻击者，缺点是可能会受到攻击者的攻击。
   - 目前使用蜜罐的系统较多的是 Linux 系统，因此蜜罐的部署也主要是在 Linux 系统上进行的。我们可以使用 Docker 来部署蜜罐，从而可以在 Linux 系统上部署蜜罐。

4. 蜜罐监控
   蜜罐监控包括蜜罐的日志监控、蜜罐的攻击监控等。

   通过蜜罐的监控我们可以得知当前系统是否受到攻击，以及受到何种攻击，从而可以对系统进行防御。

#### 4. 安全规范

##### 4.1. 应用安全

应用安全包括应用的安全设计、应用的安全开发、应用的安全测试等。
安全设计：应用的安全设计包括应用的安全需求分析、应用的安全架构设计等。

1. 密钥管理
2. 身份认证
3. 访问控制
4. 安全日志

安全开发：应用的安全开发包括应用的安全编码、应用的安全测试等。
安全测试：应用的安全测试包括应用的安全测试计划、应用的安全测试执行、应用的安全测试报告等。

##### 4.2. 数据安全

1. 数据的分类
   数据的分类包括数据的敏感度、数据的重要性、数据的敏感性等。
2. 数据的保护
   数据的保护包括数据的加密、数据的备份、数据的恢复等。
3. 数据的安全
   对于数据的安全，需要对数据的安全进行管理，包括数据的安全管理计划、数据的安全管理制度、数据的安全管理流程等。
4. 数据的审计
   数据的审计包括数据的审计计划、数据的审计执行、数据的审计报告等。
5. 数据的销毁
   对于不再使用的数据，应当及时销毁，防止数据泄露。

#### 5. 安全培训

安全培训包括安全培训的计划、安全培训的实施、安全培训的评估等。

| 培训内容     | 培训对象 | 培训方式 |
| ------------ | -------- | -------- |
| 安全意识培训 | 全体员工 | 讲座     |
| 安全操作培训 | 全体员工 | 讲座     |
| 安全管理培训 | 全体员工 | 讲座     |
| 安全技术培训 | 全体员工 | 讲座     |

### 防御流程

#### 规约与描述

实施安全方案之后，我们需要针对切实存在的安全威胁进行防御，从而保证系统的安全。针对安全威胁的防御划分为以下几个阶段：即备战期、攻防期、收尾期。

1. 备战期
   备战期是指在攻击发生之前，对攻击进行预防和预防的准备工作。在备战期间，我们主要做了两件事情，一是减小攻击面，二是排查风险点。

   - 减小攻击面：我们可以通过减小攻击面来减少攻击的范围，从而减少攻击的可能性。减小攻击面的方法有：减少对外开放的端口、服务、系统等。

   - 排查风险点：我们可以通过排查风险点来减少攻击的可能性。排查风险点的方法有很多，比如排查系统的漏洞、排查系统的配置等。

2. 攻防期
   攻防期是指在攻击发生之后，对攻击进行防御和应对的工作。

   - 对攻击进行防火墙过滤、对攻击进行入侵检测等
   - 对攻击进行日志分析、对攻击进行流量分析等

3. 收尾期
   收尾期是指在攻击结束之后，对攻击进行总结和反思的工作。

   - 对攻击进行总结和反思
   - 对攻击进行修复和补救

#### 防御工具

- 防火墙
- 入侵检测系统
- 日志分析系统
- 流量分析系统
- 安全审计系统
- 数据备份系统
- 蜜罐系统

## 检查清单

| 问题分类    | 问题                         | 解决方案                                                                              |
| ----------- | ---------------------------- | ------------------------------------------------------------------------------------- |
| 1. 资产梳理 | 1.1 你的公司有哪些资产？     | 1.1 列出公司的资产清单                                                                |
| 2. 网络安全 | 2.1 是否开放了不必要的端口？ | 2.1 关闭不必要的端口                                                                  |
| 2. 网络安全 | 2.2 是否开放了不必要的服务？ | 2.2 关闭不必要的服务                                                                  |
| 2. 网络安全 | 2.3 是否开放了不必要的系统？ | 2.3 关闭不必要的系统                                                                  |
| 2. 网络安全 | 2.4 是否使用了 https？       | 2.4 对开放的服务使用 https                                                            |
| 3. 系统安全 | 3.1 是否存在操作系统漏洞？   | 3.1 检查系统漏洞，及时修复                                                            |
| 3. 系统安全 | 3.2 是否存在配置错误？       | 3.2 检查系统配置                                                                      |
| 4. 数据安全 | 4.1 是否存在敏感数据？       | 4.1 检查敏感数据，及时销毁                                                            |
| 4. 数据安全 | 4.2 是否进行了数据备份？     | 4.2 对重要数据制定备份计划并实施                                                      |
| 5. 应用安全 | 5.1 是否存在应用漏洞？       | 5.1 进行应用漏洞扫描，及时修复                                                        |
| 5. 应用安全 | 5.2 是否存在配置错误？       | 5.2 检查应用配置，例如：数据库密码、数据库权限、swagger、debug、后台地址、heapdump 等 |
| 5. 应用安全 | 5.3 代码是否存在安全问题？   | 5.3 进行代码安全扫描，及时修复，配置代码扫描工具至 CI/CD 流水线                       |
| 6. 安全监控 | 6.1 是否设置了蜜罐系统？     | 6.1 设置蜜罐系统对攻击行为进行监控                                                    |
| 6. 安全监控 | 6.2 是否对日志进行监控？     | 6.2 设置日志监控系统进行安全监控                                                      |
| 7. 安全培训 | 7.1 是否进行了安全培训？     | 7.1 定期进行安全培训，提高员工安全意识                                                |

## 参考资料

- [OWASP Top 10 2017](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project)
