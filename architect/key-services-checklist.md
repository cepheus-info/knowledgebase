# 关键服务识别与处理清单

## 1. 概览

### 1.1. 关键服务清单

- [ ] [认证服务](#smso-auth-service)

- [ ] [单位服务](#smso-organization-service)

- [ ] [配置中心](#config-service)

- [ ] [数据库](#database)

- [ ] [消息队列](#Kafka)

- [ ] [缓存](#Redis)

- [ ] [AxonServer](#AxonServer)

## 2. 处理方式

处理方式包括但不限于：

- [ ] 立即切断 Nginx 入口的流量，将其导向预定义静态页面，直至服务恢复

- [ ] 零等待重启服务

- [ ] 全局停机处理和故障恢复

### 2.1. 认证服务

认证服务是整个系统的入口，其健康状态直接影响整个系统的可用性。认证服务停机后，整个系统将处于无法使用状态，因此，认证服务的健康检查及处理措施应当是最严格的。

### 2.2. 单位服务

单位服务为支撑系统的基础服务，可在切断流量后，首先尝试重启服务和 Zero downtime 拉起，若重启失败，则依次对应用系统进行停机处理和故障恢复。

### 2.3. 配置中心

配置中心出现异常时会引起应用系统仍然能进行请求，但是请求结果不正确甚至阻塞累积的现象，因此，当识别到配置中心出现异常时，可能已经发生多个失败累积的请求，此时仅仅切断流量和重启服务是不够的，应当对应用系统进行停机处理和故障恢复。

### 2.4. 数据库、Axon Server

一般来说上述组件出现异常的可能性相对较低，同时数据库也有集群保证可用性，但是一旦出现故障，对应用的影响也是最大规模的，需要切流的同时果断对相关联的应用系统执行停机处理和故障恢复。

### 2.5. Kafka

Kafka 作为消息队列，其出现故障的可能性较低，影响范围目前限于业务系统中的部分服务，因此，当发生异常时，应对受影响的服务进行停机处理至 Kafka 恢复。

### 2.6. Redis

部分其他关键服务依赖 Redis，需要按依赖方的处理方式进行处理。

## 3. 总结

一般而言，上述服务既作为支撑应用系统的基础服务，也作为应用系统的一部分被认为是关键服务，需要对其进行健康检查，以保证整个服务的可用性。同时，为避免关键服务拉起过程压力太大，应当在关键服务停机后，对依赖该服务的应用系统进行限流甚至切断，直至关键服务恢复。
