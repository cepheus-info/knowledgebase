# 三相一致性检查

## 1. 工作项

| ID     | PBI                            |
| ------ | ------------------------------ |
| s1-p01 | 【三相一致性】异常单位列表     |
| s1-p02 | 【三相一致性】异常人员数据详情 |
| s1-p03 | 【三相一致性】标记异常数据     |
| s1-p04 | 【三相一致性】统计单位异常     |
| s1-p05 | 【三相一致性】全库统计异常     |

## 2. 详细设计

### 2.1. 异常单位列表

> 工作项

- s1-p01【三相一致性】异常单位列表

#### 2.1.1. 列表设计

> 查询条件

- 单位代码
- 单位名称
- 基金月份
- 统计月份

> 列表字段

| `ConflictId` | 单位 Id | 单位代码 | 单位名称         | 基金月份 | 统计月份 | 异常变动数 | 操作                |
| ------------ | ------- | -------- | ---------------- | -------- | -------- | ---------- | ------------------- |
| uuid         | uuid    | code0001 | 四川省医学科学院 | 2023-06  | 2023-06  | 20         | 重新统计 / 查看详情 |

Note: `ConflictId` 为 uuid，用于查看详情时传参, 唯一性由单位 Id + 统计月份决定。

> 接口列表

- 1.1 按条件查询异常单位列表

- 1.2 重新统计单位异常

### 2.2. 异常人员列表/详情

> 工作项

- s1-p02【三相一致性】异常人员数据详情

#### 2.2.1. 异常人员列表设计

> 查询条件（前端）

- 人员编号
- 人员姓名

| 人员 Id | 人员编号 | 人员姓名 |
| ------- | -------- | -------- |
| 人员 Id | 人员编号 | 人员姓名 |

> 接口列表

- 2.1 按 `ConflictId` 查询异常人员列表

#### 2.2.2. 异常人员详情设计

> 查询条件（前端）

- 变动类型
- 起薪时间

| 变动记录 Id  | 变动类型 | 起薪时间 | 异常字段 | 变动记录 | 变动花名册   | 事件记录   |
| ------------ | -------- | -------- | -------- | -------- | ------------ | ---------- |
| 变动记录 Id1 | 人员新增 | 2022-01  | 工资合计 | 1000     | 变动花名册 1 | 事件记录 1 |

> 接口列表

- 2.2 按 `ConflictId` + `人员 Id` 查询异常人员详情

### 2.3. 标记异常数据

> 工作项

- s1-p03【三相一致性】标记异常数据

#### 2.3.1. 标记异常数据设计

可对选中变动记录标记为异常数据，标记后该变动记录的详细字段对比将记录在异常人员数据详情中，编辑变动记录时，可以查看已标记的数据。

### 2.4. 按单位统计异常

> 工作项

- s1-p04【三相一致性】统计单位异常

### 2.5. 全库统计当前异常

> 工作项

- s1-p05【三相一致性】全库统计异常

#### 2.5.1. 全库统计当前异常设计

由统一接口发起检查，检查完成后，将检查结果记录并返回。结果表可通过 UI 查询功能查看。

## 3. 术语表

| 术语       | 解释                     | 详细描述                     |
| ---------- | ------------------------ | ---------------------------- |
| 异常类型   | 用于区分数据不一致的种类 | [异常类型](#31-异常类型)     |
| ConflictId | 用于标识单位异常         | [ConflictId](#32-conflictid) |

### 3.1. 异常类型

| 异常类型 | 解释                                           |
| -------- | ---------------------------------------------- |
| 缺失     | 变动记录、变动花名册、事件记录中整条数据缺失   |
| 不一致   | 变动记录、变动花名册、事件记录中某个字段不一致 |
| 多余     | 变动记录、变动花名册、事件记录中多余的数据     |

### 3.2. ConflictId

由单位 Id + 统计月份决定，用于标识单位异常。

## 4. 结论

- 三相一致性检查功能，由后端提供接口，前端调用接口实现功能。
