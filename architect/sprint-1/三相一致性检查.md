# 三相一致性检查

## 1. 工作项

| ID       | PBI                                      |
| -------- | ---------------------------------------- |
| s0.2-p02 | 【三相一致性】按单位提供异常人员数据列表 |
| s0.2-p02 | 【三相一致性】异常人员数据详情           |
| s0.2-p03 | 【三相一致性】标记异常数据               |

## 2. 详细设计

### 2.1. 按单位提供异常人员数据列表

#### 2.1.1. 业务逻辑

| 单位代码   | 基金月份   | 人员 Id  | 人员编号   | 人员姓名   | 异常类型   | 异常描述   |
| ---------- | ---------- | -------- | ---------- | ---------- | ---------- | ---------- |
| 单位代码 1 | 基金月份 1 | 人员 Id1 | 人员编号 1 | 人员姓名 1 | 异常类型 1 | 异常描述 1 |

### 2.2. 异常人员数据详情

#### 2.2.1. 业务逻辑

当前查看的异常人员数据详情

| 人员 Id | 人员编号 | 人员姓名 | 异常类型 | 异常描述 | 变动类型 | 变动时间 |
| ------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 人员 Id | 人员编号 | 人员姓名 | 异常类型 | 异常描述 | 变动类型 | 变动时间 |

详细数据字段:

| 变动记录 Id  | 异常字段   | 变动记录   | 变动花名册   | 事件记录   |
| ------------ | ---------- | ---------- | ------------ | ---------- |
| 变动记录 Id1 | 异常字段 1 | 变动记录 1 | 变动花名册 1 | 事件记录 1 |

#### 2.2.2. 接口设计

异常人员数据汇总

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "total": 1,
    "list": [
      {
        "unitCode": "单位代码",
        "fundMonth": "基金月份",
        "personId": "人员 Id",
        "personCode": "人员编号",
        "personName": "人员姓名",
        "exceptionType": "异常类型",
        "exceptionDesc": "异常描述"
      }
    ]
  }
}
```

异常人员数据详情

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "personId": "人员 Id",
    "personCode": "人员编号",
    "personName": "人员姓名",
    "exceptionType": "异常类型",
    "exceptionDesc": "异常描述",
    "changeType": "变动类型",
    "changeTime": "变动时间",
    "changeRecord": {
      "changeRecordId": "变动记录 Id",
      "exceptionField": "异常字段",
      "changeRecord": "变动记录",
      "changeRoster": "变动花名册",
      "eventRecord": "事件记录"
    }
  }
}
```

### 2.3. 标记异常数据

#### 2.3.1. 业务逻辑

可对选中变动记录标记为异常数据，标记后该变动记录的详细字段对比将记录在异常人员数据详情中，编辑变动记录时，可以查看已标记的数据。

### 2.4. 检查接口

由统一接口发起检查，检查完成后，将检查结果记录并返回。结果表可通过 UI 查询功能查看。
